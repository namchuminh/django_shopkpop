{% extends "base.html" %}
{% load static %}

{% block title %}
{{ title }}
{% endblock title %}

{% block content%}
<div class="ltn__utilize-overlay"></div>
<div class="ltn__breadcrumb-area ltn__breadcrumb-area-4 ltn__breadcrumb-color-white---">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="ltn__breadcrumb-inner text-center">
                    <h1 class="ltn__page-title">Sản Phẩm</h1>
                    <div class="ltn__breadcrumb-list">
                        <ul>
                            <li><a href="{% url 'home' %}">Trang Chủ</a></li>
                            <li><a href="{% url 'product' %}">Sản Phẩm</a></li>
                            <li><a href="#">{{ sanpham.TenSanPham }}</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="ltn__shop-details-area pb-70">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12">
                <div class="ltn__shop-details-inner">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="ltn__shop-details-img-gallery ltn__shop-details-img-gallery-2">
                                <div
                                    class="ltn__shop-details-small-img slick-arrow-2 slick-initialized slick-slider slick-vertical">
                                    <div aria-live="polite" class="slick-list draggable" style="height: 648.752px;">
                                        <div class="single-small-img">
                                            <img style="width: 114px; height: 118px;" src="{{ sanpham.AnhChinh.url }}" alt="Image">
                                        </div>
                                        <div class="single-small-img">
                                            <img style="width: 114px; height: 118px;" src="{{ sanpham.AnhPhu1.url }}" alt="Image">
                                        </div>
                                        <div class="single-small-img">
                                            <img style="width: 114px; height: 118px;" src="{{ sanpham.AnhPhu2.url }}" alt="Image">
                                        </div>
                                        <div class="single-small-img">
                                            <img style="width: 114px; height: 118px;" src="{{ sanpham.AnhPhu3.url }}" alt="Image">
                                        </div>
                                        <div class="single-small-img">
                                            <img style="width: 114px; height: 118px;" src="{{ sanpham.AnhChinh.url }}" alt="Image">
                                        </div>
                                    </div>

                                </div>
                                <div class="ltn__shop-details-large-img slick-initialized slick-slider">
                                    <div aria-live="polite" class="slick-list draggable">
                                        <div class="single-large-img">
                                            <a href="#" data-rel="lightcase:myCollection"
                                                tabindex="0">
                                                <img style="width: 492px; height: 640px;" src="{{ sanpham.AnhChinh.url }}" alt="Image">
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="modal-product-info shop-details-info pl-0">
                                <h3 class="animated fadeIn">{{ sanpham.TenSanPham }}</h3>
                                <div class="product-price-ratting mb-20">
                                    <ul>
                                        <li>
                                            <div class="product-price">
                                                <span>{{ sanpham.GiaBan }}đ</span>
                                                <del>{{ sanpham.GiaKhuyenMai }}đ</del>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="product-ratting">
                                                <ul>
                                                    <li><a href="#"><i class="icon-star"></i></a></li>
                                                    <li><a href="#"><i class="icon-star"></i></a></li>
                                                    <li><a href="#"><i class="icon-star"></i></a></li>
                                                    <li><a href="#"><i class="icon-star"></i></a></li>
                                                    <li><a href="#"><i class="icon-star"></i></a></li>
                                                </ul>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <div class="modal-product-brief">
                                    <p>{{ sanpham.MoTaNgan }}</p>
                                </div>
                                <div class="modal-product-meta ltn__product-details-menu-1 mb-20">
                                    <ul>
                                        <li>
                                            <div class="ltn__color-widget clearfix">
                                                <strong class="d-meta-title">Màu Sắc</strong>
                                                <input type="hidden" value="" class="mausac">
                                                {% csrf_token %}
                                                <ul>
                                                    {% for item in sanpham.MauSac.all %}
                                                        <li class="mau{{ item.id }} theme" style="cursor: pointer; background-color: {{ item.MaMauSac }}"></li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <div class="ltn__product-details-menu-2 product-cart-wishlist-btn mb-30">
                                    <ul>
                                        <li>
                                            <div class="cart-plus-minus">
                                                <div class="dec qtybutton">-</div>
                                                <input type="number" min="1" value="1" name="qtybutton"
                                                    class="cart-plus-minus-box soluong">
                                                <div class="inc qtybutton">+</div>
                                            </div>
                                        </li>
                                        <li>
                                            <button href="#" class="theme-btn-1 btn btn-effect-1 d-add-to-cart">
                                                <span>THÊM GIỎ HÀNG</span>
                                            </button>
                                        </li>
                                        <li>
                                            <a href="#" class="btn btn-effect-1 d-add-to-wishlist" title="Add to Cart"
                                                data-bs-toggle="modal" data-bs-target="#add_to_cart_modal">
                                                <i class="icon-heart"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <br>
                                <div class="ltn__social-media mb-30">
                                    <ul>
                                        <li class="d-meta-title">Chia Sẻ:</li>
                                        <li><a href="#" title="Facebook"><i class="icon-social-facebook"></i></a></li>
                                        <li><a href="#" title="Twitter"><i class="icon-social-twitter"></i></a></li>
                                        <li><a href="#" title="Pinterest"><i class="icon-social-pinterest"></i></a></li>
                                        <li><a href="#" title="Instagram"><i class="icon-social-instagram"></i></a></li>

                                    </ul>
                                </div>
                                <div class="modal-product-meta ltn__product-details-menu-1 mb-30">
                                    <ul>
                                        <li><strong>Mã Sản Phẩm:</strong> <span>#SP{{ sanpham.id }}</span></li>
                                        <li>
                                            <strong>Chuyên Mục:</strong>
                                            <span>
                                                <a href="#">{{ sanpham.ChuyenMuc.TenChuyenMuc }}</a>
                                            </span>
                                        </li>
                                        <li>
                                            <strong>Thẻ:</strong>
                                            <span>
                                                {{ sanpham.The }}
                                            </span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="ltn__shop-details-tab-area pb-60">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="ltn__shop-details-tab-inner">
                    <div class="ltn__shop-details-tab-menu">
                        <div class="nav">
                            <a class="active show" data-bs-toggle="tab" href="#liton_tab_details_1_1">Mô Tả - Sản Phẩm</a>
                        </div>
                    </div>
                    <div class="tab-content">
                        <div class="tab-pane fade active show" id="liton_tab_details_1_1">
                            <div class="" style="line-height: 40px;">
                                {{ sanpham.MoTaDai|safe }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="ltn__product-slider-area pb-40">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="section-title-area text-center">
                    <h1 class="section-title section-title-border">Sản Phẩm Liên Quan</h1>
                </div>
            </div>
        </div>
        <div class="row ">
                {% for item in sanphamlienquan %}
                <div class="col-xl-3 col-sm-4 col-12">
                    <div class="ltn__product-item text-center">
                        <div class="product-img">
                            <a href="{% url 'detail_product' slug=item.DuongDan %}"><img style="height: 374px; image-rendering: -webkit-optimize-contrast;" src="{{ item.AnhChinh.url }}" alt="#"></a>
                            <div class="product-badge">
                                <ul>
                                    <li class="badge-1">- {{ item.PhanTramGiam }}%</li>
                                </ul>
                            </div>
                            <div class="product-hover-action product-hover-action-2">
                                <ul>
                                    <li class="add-to-cart">
                                        <a href="#" title="Add to Cart" data-bs-toggle="modal" data-bs-target="#add_to_cart_modal">
                                            <span class="{{ item.id }} cart-text d-none d-xl-block">THÊM GIỎ HÀNG</span>
                                            <span class="d-block d-xl-none"><i class="icon-handbag"></i></span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="product-info">
                            <h2 class="product-title"><a href="{% url 'detail_product' slug=item.DuongDan %}">{{ item.TenSanPham }}</a></h2>
                            <div class="product-price">
                                <span>{{ item.GiaBan }}đ</span>
                                <del>{{ item.GiaKhuyenMai }}đ</del>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
        </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script>
    $(document).ready(function(){
        $('.ltn__brand-logo-area').addClass('d-none')

        $('.theme').click(function(e){
            $('.theme').removeClass('theme-active')
            $(this).addClass('theme-active')
            const mauId = $(this).first().attr("class")
            $('.mausac').val(mauId.split(" ")[0][3])
        })

        $('.d-add-to-cart').click(function(e){
            const soluong = $(".soluong").val()
            const mausac = $(".mausac").val()
            const masanpham = "{{ sanpham.id }}"

            if(mausac == ""){
                alert("Vui Lòng Chọn Màu Sắc!")
                return
            }

            if(masanpham == ""){
                alert("Vui Lòng Không Sửa Mã Sản Phẩm!")
                return
            }

            if(soluong <= 0){
                alert("Số Lượng Sản Phẩm Phải Lớn Hơn 0!")
                return
            }

            $.post("{% url 'add_product_cart' %}", 
                {soluong, mausac, masanpham, csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()}, 
                function(result){
                    var keys = Object.keys(result)
                    if (keys[0] == "error"){
                        alert(result.error)
                        return
                    }

                    if (keys[0] == "success"){
                        alert(result.success)
                        location.reload(true);
                    }
                }
            );
        })

        $('.cart-text').click(function(e){
            var masanpham = $(this).first().attr("class").split(" ")[0]
            $.get("{% url 'add_product_cart' %}", 
                {masanpham}, 
                function(result){
                    var keys = Object.keys(result)
                    if (keys[0] == "error"){
                        alert(result.error)
                        return
                    }

                    if (keys[0] == "success"){
                        alert(result.success)
                        location.reload(true);
                    }
                }
            );
        })
    });
</script>
{% endblock content%}